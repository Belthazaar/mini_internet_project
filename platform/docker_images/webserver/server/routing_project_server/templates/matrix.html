{% extends "base.html" %}
{% block head %}
{{ super() }}
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta http-equiv="refresh" content="60" />
{% endblock %}
{% block body %}
<!-- Column for text etc with fixed size. -->
<div class="max-w-4xl mx-auto p-6">
	<h1 class="text-4xl underline underline-offset-2 decoration-4 decoration-[#ff7e79] mono mb-4">connectivity matrix
	</h1>
	<p class="mb-2">
		This connectivity matrix indicates the networks that each group
	</p>
	<ul class="list-disc list-inside mb-2">
		<li>can reach with a valid AS-level path (<span class="bg-[#56c157]">&nbsp;&nbsp;&nbsp;</span>);
		</li>
		<li>can reach with an invalid AS-level path (<span class="bg-[#f0ad4e]">&nbsp;&nbsp;&nbsp;</span>);
		</li>
		<li>cannot reach (<span class="bg-[#d5605e]">&nbsp;&nbsp;&nbsp;</span>). </li>
	</ul>
	<p class="mb-8">
		We determine reachability by sending periodic pings between all networks,
		if the ping succeeds, we consider the AS reachable.
		In addition to the ping, we compare the BGP looking glass outputs with
		the project topology to determine whether the path between two ASes is valid, i.e. if it does not violate any
		policies.
	</p>
	<!-- Progress bar -->
	<div class="w-full rounded-lg bg-neutral-700 flex mb-8">
		<div class="basis-[{{valid}}%] rounded-l-lg px-2 p-1 bg-[#56c157]"
			title="Reachabile with valid path: {{valid}}%">
			{{valid}}%
		</div>
		<div class="basis-[{{invalid}}%] px-2 p-1 bg-[#f0ad4e]" title="Reachabile with invalid path: {{invalid}}%">
			{{invalid}}%
		</div>
		<div class="basis-[{{failure}}%] px-2 p-1 rounded-r-lg bg-[#d5605e]" title="Not reachabile: {{failure}}%">
			{{failure}}%
		</div>
	</div>
</div>

<!-- Matrix is allowed to spread out more. -->
{% set n = connectivity|length + 1 %}
<div class="max-w-full mx-auto">
	<div class="grid border border-neutral-300 border-collapse mx-8"
		style="grid-template-columns: repeat({{ n }}, minmax(0, 1fr));">
		<!-- header row. -->
		<div class=" border border-neutral-300"></div>
		{% for asn in connectivity|sort %}
		<div class="border border-neutral-300 text-center">{{ asn }}</div>
		{% endfor %}
		<!-- content rows -->
		{% for asn in connectivity|sort %}
		<div class="border border-neutral-300 odd:bg-neutral-200 text-right">G{{asn}}</div>
		{% for asn_dst in connectivity[asn]|sort %}
		{% if not connectivity[asn][asn_dst] %}
		<div class="border border-neutral-300 bg-[#d5605e]" title="AS{{asn}} <-> AS{{asn_dst}}: Not Reachable">
		</div>
		{% else %}
		<!-- TODO! -->
		{% if validity[asn].get(asn_dst, False) %}
		<div class="border border-neutral-300 bg-[#56c157]"
			title="AS{{asn}} <-> AS{{asn_dst}}: Reachable with valid path">
		</div>
		{% else %}
		<div class="border border-neutral-300 bg-[#f0ad4e]"
			title="AS{{asn}} <-> AS{{asn_dst}}: Reachable with invalid path">
		</div>
		{% endif %}
		{% endif %}
		{% endfor %}
		{% endfor %}
	</div>
</div>
{% endblock %}