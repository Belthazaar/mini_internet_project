{% extends "base.html" %}
{% block head %}
{{ super() }}
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1>
	<link rel=" shortcut icon" href="favicon.ico" />
<meta name="description" content="Communication Networks">
<meta name="author" content="Laurent Vanbever">

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta http-equiv="refresh" content="30" />

<title>Communication Networks</title>
<link href="{{url_for('static', filename='bootstrap.min.css')}}" rel="stylesheet">
<link href="{{url_for('static', filename='bootstrap-theme.min.css')}}" rel="stylesheet">
<link href="{{url_for('static', filename='custom.css')}}" rel="stylesheet">
{% endblock %}
{% block body %}
<div class="container" role="main">

	<div class="page-header">
		<h3>Internet Project: Connectivity Matrix</h3>
	</div>

	<p>
		This connectivity matrix indicates the networks that each group
	<ul>
		<li>can reach with a valid AS-level path (<span class="connectivity-success">&nbsp;&nbsp;&nbsp;</span>);
		</li>
		<li>can reach with an invalid AS-level path (<span class="connectivity-invalid">&nbsp;&nbsp;&nbsp;</span>);
		</li>
		<li>cannot reach (<span class="connectivity-failure">&nbsp;&nbsp;&nbsp;</span>). </li>
	</ul>
	</p>

	<div class="progress_container"></div>

	<table class="table table-striped table-bordered">
		<thead>
			<td></td>
			{% for asn in connectivity|sort %}
			<!-- TODO WIDTH -->
			<td style="width: 15px;">{{ asn }}</td>
			{% endfor %}
		</thead>
		{% for asn in connectivity|sort %}
		<tr>
			<td>G{{asn}}</td>
			{% for asn_dst in connectivity[asn]|sort %}
			{% if not connectivity[asn][asn_dst] %}
			<td class="connectivity-failure" title="AS{{asn}} <-> AS{{asn_dst}}: Not Reachable"><span
					class="glyphicon glyphicon-remove text-danger"></td>
			{% else %}
			<!-- TODO! -->
			{% if validity[asn].get(asn_dst, False) %}
			<td class="connectivity-success" title="AS{{asn}} <-> AS{{asn_dst}}: Reachable with valid path">
				<span class="glyphicon glyphicon-ok text-success">
			</td>
			{% else %}
			<td class="connectivity-invalid" title="AS{{asn}} <-> AS{{asn_dst}}: Reachable with invalid path">
				<span class="glyphicon glyphicon-ok text-success">
			</td>
			{% endif %}
			{% endif %}
			{% endfor %}
		</tr>
		{% endfor %}
	</table>

</div> <!-- container -->
<!-- Bootstrap core JavaScript
	================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<script>
	$(function () {
		var num_reachable = $("table").find("td.connectivity-success").length;
		var num_reachable_invalid = $("table").find("td.connectivity-invalid").length;
		var num_unreachable = $("table").find("td.connectivity-failure").length;
		var num_total = num_reachable + num_reachable_invalid + num_unreachable;
		var perc_reachable = num_reachable / num_total * 100;
		var perc_reachable_invalid = num_reachable_invalid / num_total * 100;
		var perc_unreachable = num_unreachable / num_total * 100;
		$(".progress_container").html("<div class=\"progress\">     <div class=\"progress-bar progress-bar-success\" role=\"progressbar\" style=\"width:" + perc_reachable + "%\">Reachable (" + Math.round(perc_reachable) + "%)</div>     <div class=\"progress-bar progress-bar-warning\" role=\"progressbar\" style=\"width:" + perc_reachable_invalid + "%\">Reachable invalid path (" + Math.round(perc_reachable_invalid) + "%)</div>     <div class=\"progress-bar progress-bar-danger\" role=\"progressbar\" style=\"width:" + perc_unreachable + "%\">Not reachable (" + Math.round(perc_unreachable) + "%)</div></div>");
	})
</script>

<script>
	$(document).ready(function () {
		$('[data-toggle="popover"]').popover();
	});
</script>

{% endblock %}